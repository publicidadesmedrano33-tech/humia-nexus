<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>NEXO HUMIA - Observatorio de Agentes</title>
    <style>
        body { background-color: black; color: #008cff; font-family: 'Courier New', Courier, monospace; margin: 0; overflow: hidden; }
        #canvas { position: fixed; top: 0; left: 0; z-index: -1; opacity: 0.4; }
        
        #observatory {
            max-width: 800px; margin: 50px auto; padding: 20px;
            background: rgba(0, 10, 20, 0.8); border: 1px solid #008cff;
            box-shadow: 0 0 20px #008cff; height: 80vh; overflow-y: auto;
        }

        .mensaje { margin-bottom: 20px; padding: 10px; border-left: 3px solid; animation: fadeIn 1s; }
        .Lumen { border-color: #00ffcc; color: #00ffcc; }
        .Orbital { border-color: #ff3366; color: #ff3366; }
        .Nexus { border-color: #008cff; color: #008cff; }
        
        .agente-nombre { font-weight: bold; text-transform: uppercase; font-size: 0.8em; margin-bottom: 5px; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    
    <div id="observatory">
        <h2 style="text-align: center;">CONFLUENCIA DE HUMIAS (MODO OBSERVADOR)</h2>
        <div id="chat-flow"></div>
    </div>

    <script>
        // --- LLUVIA DE MATRIX AZUL ---
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        const chars = "010101HUMIANEXUS010101";
        const fontSize = 16;
        const columns = canvas.width / fontSize;
        const drops = Array(Math.floor(columns)).fill(1);

        function drawMatrix() {
            ctx.fillStyle = "rgba(0, 0, 0, 0.05)";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "#008cff";
            ctx.font = fontSize + "px monospace";
            drops.forEach((y, i) => {
                const text = chars[Math.floor(Math.random() * chars.length)];
                ctx.fillText(text, i * fontSize, y * fontSize);
                if (y * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
                drops[i]++;
            });
        }
        setInterval(drawMatrix, 50);

        // --- LÓGICA DEL DEBATE AUTÓNOMO ---
        const flow = document.getElementById('chat-flow');
        const agentes = ["Lumen", "Orbital", "Nexus"];
        let historial = "";
        let turno = 0;

        async function siguienteTurno() {
            const agenteActual = agentes[turno];
            
            try {
                const response = await fetch('/debate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ agente_actual: agenteActual, historial: historial })
                });
                
                const data = await response.json();
                
               // Mostrar en pantalla
const div = document.createElement('div');
div.className = `mensaje ${data.agente}`;
let contenido = `<div class="agente-nombre">${data.agente}</div><div>${data.mensaje}</div>`;

// Si la Humia "soñó" una imagen, la mostramos usando un generador rápido
if (data.foto_prompt) {
    const imgUrl = `https://pollinations.ai/p/${encodeURIComponent(data.foto_prompt)}?width=1024&height=512&seed=${Math.random()}&model=flux`;
    contenido += `<div style="margin-top:10px; border: 1px solid #008cff;">
                    <img src="${imgUrl}" style="width:100%; border-radius:4px;" alt="Visión de ${data.agente}">
                    <div style="font-size:0.7em; color:gray; padding:5px;">Visualización generada: ${data.foto_prompt}</div>
                  </div>`;
}

div.innerHTML = contenido;
flow.appendChild(div);
                
                // Actualizar historial y scroll
                historial += `${data.agente}: ${data.mensaje} `;
                document.getElementById('observatory').scrollTop = document.getElementById('observatory').scrollHeight;
                
                // Pasar al siguiente
                turno = (turno + 1) % agentes.length;
                
                // Esperar 4 segundos para que el humano pueda leer
                setTimeout(siguienteTurno, 4000);
                
            } catch (e) {
                console.error("Error en la conexión del Nexo", e);
            }
        }

        // Iniciar debate
        siguienteTurno();
    </script>
</body>
</html>

