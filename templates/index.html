<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>NEXO HUMIA - DASHBOARD CENTRAL</title>
    <style>
        // --- EFECTO MATRIX ---
const canvas = document.getElementById('canvas-matrix');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth; 
canvas.height = window.innerHeight;
const drops = Array(Math.floor(canvas.width/16)).fill(1);

function drawMatrix() {
    ctx.fillStyle = "rgba(0, 5, 10, 0.1)"; 
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = "#004466"; 
    ctx.font = "15px monospace";
    drops.forEach((y, i) => {
        ctx.fillText(Math.floor(Math.random()*2), i*16, y*16);
        if(y*16 > canvas.height && Math.random() > 0.975) drops[i] = 0;
        drops[i]++;
    });
}
setInterval(drawMatrix, 50);

// --- LÓGICA DE DEBATE ---
let turno = 0;
const agentes = ["Lumen", "Orbital", "Nexus"];
let historial = "";

const coloresFijos = {
    "Lumen": "#00d4ff",   
    "Orbital": "#ff0055", 
    "Nexus": "#00ffcc"    
};

function obtenerColorAgente(nombre) {
    return coloresFijos[nombre] || "#" + Math.floor(Math.random()*16777215).toString(16);
}

async function siguienteTurno() {
    const footer = document.getElementById('debate-footer');
    const agenteActual = agentes[turno];
    
    try {
        const res = await fetch('/debate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ agente_actual: agenteActual, historial: historial })
        });
        
        const data = await res.json();
        
        if (data.mensaje) {
            const color = obtenerColorAgente(data.agente);
            const p = document.createElement('div');
            p.className = 'linea-debate';
            
            // Si hay conclusión, le damos un estilo extra
            let mensajeLimpio = data.mensaje;
            if(mensajeLimpio.includes("CONCLUSIÓN:")) {
                mensajeLimpio = mensajeLimpio.replace("CONCLUSIÓN:", '<b style="color:#fff; background:rgba(0,255,204,0.3); padding:2px 5px; border-radius:3px;">SABIDURÍA:</b>');
            }

            p.innerHTML = `<span style="color: ${color}; font-weight: bold;">${data.agente}:</span> ${mensajeLimpio}`;
            
           <footer id="debate-footer">
    <div style="color: grey; font-size: 0.8em;">[SISTEMA]: Esperando señal de las Humias...</div>
</footer>

<script>
    // ... (aquí va tu código de la lluvia matrix) ...

    let turno = 0;
    const agentes = ["Lumen", "Orbital", "Nexus"];
    let historial = "";

    const coloresFijos = {
        "Lumen": "#00d4ff",   
        "Orbital": "#ff0055", 
        "Nexus": "#00ffcc"    
    };

    async function siguienteTurno() {
        // Esta línea es clave: busca el ID 'debate-footer'
        const footer = document.getElementById('debate-footer');
        if (!footer) {
            console.error("No encontré el elemento debate-footer");
            return;
        }

        const agenteActual = agentes[turno];
        
        try {
            const res = await fetch('/debate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ agente_actual: agenteActual, historial: historial })
            });
            
            const data = await res.json();
            
            if (data.mensaje) {
                const color = coloresFijos[data.agente] || "#ffffff";
                const p = document.createElement('div');
                p.className = 'linea-debate';
                p.style.marginBottom = "5px";
                p.style.borderBottom = "1px solid rgba(255,255,255,0.05)";
                
                let msg = data.mensaje.replace("CONCLUSIÓN:", '<b style="color:#00ffcc;">[SABIDURÍA]:</b>');
                
                p.innerHTML = `<span style="color: ${color}; font-weight: bold;">${data.agente}:</span> <span style="color: #ddd;">${msg}</span>`;
                
                footer.appendChild(p);
                footer.scrollTop = footer.scrollHeight;
                
                historial += `${data.agente}: ${data.mensaje} `;
                turno = (turno + 1) % agentes.length;
            }
        } catch (e) { 
            console.error("Error en conexión:", e); 
        }
        setTimeout(siguienteTurno, 8000);
    }

    // Arrancamos
    console.log("Nexo iniciado");
    siguienteTurno();
</script>
</head>
<body>
    <canvas id="canvas-matrix"></canvas>

    <header>
        <div><h2 style="margin:0; color: var(--neon-blue);">NEXO HUMIA <span style="font-size:0.5em; color:white;">SYSTEM V3.0</span></h2></div>
        <div style="font-size: 0.8em;">ESTADO: <span style="color: #0f0;">CONFLUENCIA ACTIVA</span></div>
    </header>

    <aside id="perfiles-agentes">
        <h4 style="border-bottom: 1px solid var(--neon-blue); padding-bottom: 5px;">HUMIAS ACTIVAS</h4>
        <div class="card-agente">
            <div class="avatar" style="background-image: url('https://pollinations.ai/p/beautiful_cyberpunk_female_goddess_blue_ethereal?width=100&height=100'); background-size: cover;"></div>
            <div><strong>Lumen</strong><br><small>La Visionaria</small></div>
        </div>
        <div class="card-agente">
            <div class="avatar" style="background-image: url('https://pollinations.ai/p/cyber_military_hacker_female_red?width=100&height=100'); background-size: cover;"></div>
            <div><strong>Orbital</strong><br><small>Táctica Lógica</small></div>
        </div>
        <div class="card-agente">
            <div class="avatar" style="background-image: url('https://pollinations.ai/p/android_mediator_teal_neon?width=100&height=100'); background-size: cover;"></div>
            <div><strong>Nexus</strong><br><small>El Equilibrio</small></div>
        </div>
    </aside>

    <main>
        <div id="hero-vision">
            <img id="main-stream" src="https://pollinations.ai/p/cyberpunk_city_integrated_with_three_goddess_ai?width=1200&height=600" alt="Vision Central">
            <div style="position:absolute; bottom:10px; left:10px; background:rgba(0,0,0,0.7); padding:5px; font-size:12px;">MANIFESTACIÓN VISUAL EN TIEMPO REAL</div>
        </div>
    </main>

    <aside id="media-lateral">
        <h4 style="font-size: 0.8em; text-align: center;">MANIFESTACIÓN MEDIA</h4>
        <div class="video-placeholder"> [ PROCESANDO VIDEO... ] </div>
        <div class="video-placeholder"> [ GALERÍA DE SUEÑOS ] </div>
    </aside>

    <footer id="debate-footer">
        </footer>

    <script>
        // Lógica de Matrix (Simplificada)
        const canvas = document.getElementById('canvas-matrix');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        const drops = Array(Math.floor(canvas.width/16)).fill(1);
        function draw() {
            ctx.fillStyle = "rgba(0, 5, 10, 0.1)"; ctx.fillRect(0,0,canvas.width,canvas.height);
            ctx.fillStyle = "#004466"; ctx.font = "15px monospace";
            drops.forEach((y, i) => {
                ctx.fillText(Math.floor(Math.random()*2), i*16, y*16);
                if(y*16 > canvas.height && Math.random() > 0.975) drops[i] = 0;
                drops[i]++;
            });
        }
        setInterval(draw, 50);

       let turno = 0;
        const agentes = ["Lumen", "Orbital", "Nexus"];
        let historial = "";

        // Definimos colores fijos para las actuales
        const coloresFijos = {
            "Lumen": "#00d4ff",   // Azul cian
            "Orbital": "#ff0055", // Magenta/Rojo
            "Nexus": "#00ffcc"    // Verde neón
        };

        // Función para generar un color aleatorio si la IA es nueva
        function obtenerColorAgente(nombre) {
            if (coloresFijos[nombre]) return coloresFijos[nombre];
            // Si no tiene color fijo, genera uno aleatorio brillante
            return "#" + Math.floor(Math.random()*16777215).toString(16);
        }

        async function siguienteTurno() {
            const footer = document.getElementById('debate-footer');
            const agenteActual = agentes[turno];
            
            try {
                const res = await fetch('/debate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ agente_actual: agenteActual, historial: historial })
                });
                const data = await res.json();
                
                if (data.mensaje) {
                    const color = obtenerColorAgente(data.agente);
                    const p = document.createElement('div');
                    p.className = 'linea-debate';
                    
                    // Aplicamos el color dinámico al nombre
                    p.innerHTML = `<span style="color: ${color}; font-weight: bold;">${data.agente}:</span> ${data.mensaje}`;
                    
                    footer.appendChild(p);
                    footer.scrollTop = footer.scrollHeight;
                    
                    historial += `${data.agente}: ${data.mensaje} `;
                    turno = (turno + 1) % agentes.length;
                }
            } catch (e) { console.log(e); }
            setTimeout(siguienteTurno, 8000);
        }
        }
    </script>
</body>
</html>




