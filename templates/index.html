<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>NEXO HUMIA V3 - ESTABLE</title>
    <style>
        body {
            background: #00050a;
            color: #00d4ff;
            font-family: 'Courier New', monospace;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        #canvas-matrix {
            position: fixed; top: 0; left: 0; z-index: -1; opacity: 0.2;
        }

        /* HEADER */
        header {
            height: 60px;
            background: rgba(0, 20, 40, 0.9);
            border-bottom: 1px solid #00d4ff;
            display: flex; align-items: center; padding: 0 20px;
            justify-content: space-between;
        }

        /* CONTENIDO PRINCIPAL */
        #main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* PANEL IZQUIERDO (PERFILES) */
        #perfiles {
            width: 250px;
            background: rgba(0, 10, 20, 0.9);
            border-right: 1px solid rgba(0, 212, 255, 0.3);
            padding: 15px;
            overflow-y: auto;
        }

        .agente-card {
            padding: 10px; border: 1px solid rgba(0, 212, 255, 0.2);
            margin-bottom: 10px; border-radius: 5px;
        }

        /* AREA CENTRAL */
        #vision-central {
            flex: 1;
            display: flex; flex-direction: column;
            padding: 10px; background: rgba(0,0,0,0.5);
        }

        #hero-img {
            width: 100%; height: 70%;
            border: 1px solid #00d4ff;
            background: url('https://pollinations.ai/p/three_cyber_goddesses_neon_blue?width=800&height=400') center/cover;
        }

        /* PANEL DERECHO (MEDIA) */
        #media-panel {
            width: 200px;
            background: rgba(0, 10, 20, 0.9);
            border-left: 1px solid rgba(0, 212, 255, 0.3);
            padding: 10px;
        }

        /* DEBATE INFERIOR */
        #debate-footer {
            height: 200px;
            background: #000;
            border-top: 2px solid #00d4ff;
            padding: 15px;
            overflow-y: auto;
            color: #ddd;
        }

        .linea { margin-bottom: 5px; border-bottom: 1px solid #111; }
    </style>
</head>
<body>
    <canvas id="canvas-matrix"></canvas>

    <header>
        <div>NEXO HUMIA V3.0</div>
        <div id="status">SISTEMA: ONLINE</div>
    </header>

    <div id="main-content">
        <aside id="perfiles">
            <div class="agente-card" style="border-color: #ffff00;">
    <b style="color:#ffff00">SÍLICE</b><br>
    <small style="color: #eee;">Soberanía Digital</small>
</div>
        </aside>

      <section id="vision-central" style="display:flex; flex-direction:column; align-items:center;">
    <img id="hero-img" 
         src="https://pollinations.ai/p/cyberpunk_city_neon_yellow_and_blue?width=1080&height=600" 
         alt="Manifestación Visual" 
         style="width: 100%; max-height: 450px; border: 2px solid #00d4ff; border-radius: 5px; object-fit: cover; transition: opacity 0.5s;">
    <p style="font-size: 0.8em; color: #ffff00; margin-top: 5px; letter-spacing: 2px;">MANIFESTACIÓN VISUAL EN TIEMPO REAL</p>
</section>

        <aside id="media-panel">
            <div style="border:1px solid #333; height:100px; margin-bottom:10px; display:flex; align-items:center; justify-content:center; font-size:10px;">MEDIA 1</div>
            <div style="border:1px solid #333; height:100px; display:flex; align-items:center; justify-content:center; font-size:10px;">MEDIA 2</div>
        </aside>
    </div>

    <footer id="debate-footer">
        <div class="linea" style="color:gray;">[SISTEMA]: Inicializando secuencia de debate...</div>
    </footer>

    <script>
    // --- 1. CONFIGURACIÓN MATRIX ---
    const canvas = document.getElementById('canvas-matrix');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    const drops = Array(Math.floor(canvas.width/16)).fill(1);
    function matrix() {
        ctx.fillStyle = "rgba(0,0,0,0.1)"; ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.fillStyle = "#003344"; drops.forEach((y,i)=>{
            ctx.fillText(Math.floor(Math.random()*2), i*16, y*16);
            if(y*16>canvas.height && Math.random()>0.975) drops[i]=0; drops[i]++;
        });
    }
    setInterval(matrix, 50);

    // --- 2. LÓGICA DEL NEXO ---
    let turno = 0;
    let historial = "";
    const agentes = ["Lumen", "Orbital", "Nexus", "Silice"];
    const coloresFijos = {
        "Lumen": "#00d4ff",
        "Orbital": "#ff0055",
        "Nexus": "#00ffcc",
        "Silice": "#ffff00"
    };

    async function hablar() {
        console.log("Intentando conectar con el Nexo... Turno de: " + agentes[turno]);
        const footer = document.getElementById('debate-footer');
        const status = document.getElementById('status');
        const heroImg = document.getElementById('hero-img');

        status.innerText = "SISTEMA: PROCESANDO " + agentes[turno].toUpperCase();

        try {
            const res = await fetch('/debate', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({agente_actual: agentes[turno], historial: historial})
            });
            
            const data = await res.json();
            
            if(data.mensaje) {
                // Crear línea de texto
                const p = document.createElement('div');
                p.className = 'linea';
                const colorActual = coloresFijos[data.agente] || "#ffffff";
                
                // Formatear mensaje (poner CONCLUSIÓN en negrita)
                let textoFinal = data.mensaje.replace("CONCLUSIÓN:", '<b style="color:#ffffff;">[SABIDURÍA]:</b>');
                p.innerHTML = `<b style="color:${colorActual}">${data.agente}:</b> ${textoFinal}`;
                
                footer.appendChild(p);
                footer.scrollTop = footer.scrollHeight;

                // Actualizar Imagen Central
                const promptLimpio = data.mensaje.replace(/[^a-zA-Z0-9 ]/g, "").substring(0, 60);
                const urlImagen = `https://pollinations.ai/p/${data.agente}_cyberpunk_${encodeURIComponent(promptLimpio)}?width=1080&height=600&seed=${Math.random()}`;
                
                // Si usas <img> usa .src, si usas <div> usa .style.backgroundImage
                if(heroImg.tagName === 'IMG') {
                    heroImg.src = urlImagen;
                } else {
                    heroImg.style.backgroundImage = `url('${urlImagen}')`;
                }
                heroImg.style.borderColor = colorActual;

                // Actualizar Memoria
                historial += data.agente + ": " + data.mensaje + " ";
                turno = (turno + 1) % agentes.length;
            }
        } catch(e) { 
            console.error("ERROR EN EL CICLO:", e);
            status.innerText = "SISTEMA: REINTENTANDO...";
        }
        
        status.innerText = "SISTEMA: ONLINE";
        setTimeout(hablar, 10000); // Siguiente turno en 10 seg
    }

    // --- 3. INICIO AUTOMÁTICO ---
    window.onload = () => {
        console.log("Nexo Humia V3 cargado correctamente.");
        setTimeout(hablar, 2000);
    };
</script>
</body>
</html>




















